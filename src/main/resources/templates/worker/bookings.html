<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>View Bookings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeInUp {
            animation: fadeInUp 1s ease-out forwards;
            opacity: 0;
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 5px rgba(34, 197, 94, 0.5);
            }

            50% {
                box-shadow: 0 0 20px rgba(34, 197, 94, 0.9);
            }

            100% {
                box-shadow: 0 0 5px rgba(34, 197, 94, 0.5);
            }
        }

        .hover-animate-glow:hover {
            animation: glow 1.5s infinite;
        }
    </style>
</head>

<body class="flex flex-col items-center min-h-screen bg-gradient-to-r from-gray-900 to-gray-800 text-white pt-20">

    <!-- Navbar -->
    <nav class="fixed top-0 left-0 w-full bg-gray-900 shadow-md z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="text-xl font-bold">Worker Dashboard</div>
            <!-- Mobile Menu Button -->
            <button id="menu-btn" class="md:hidden text-white text-3xl focus:outline-none">
                â˜°
            </button>
        </div>

        <!-- Dropdown Menu -->
        <div id="menu"
            class="transition-all duration-500 ease-in-out max-h-0 overflow-hidden md:max-h-full md:flex md:flex-row md:items-center md:justify-center md:space-x-4 space-y-2 md:space-y-0 text-center px-4 md:pb-0 flex flex-col text-white font-medium">
            <a href="/worker/dashboard" class="py-2 px-4 hover:text-green-400">Home</a>
            <a href="/skills/add" class="py-2 px-4 hover:text-green-400">Add a Skill</a>
            <a href="/worker/bookings" class="py-2 px-4 hover:text-green-400">View Requests</a>
            <a href="/feedback/leave-review" class="py-2 px-4 hover:text-green-400">Leave a Review</a>
            <a href="/profile" class="py-2 px-4 hover:text-green-400">View Profile</a>
            <a href="/auth/logout" class="py-2 px-4 hover:text-red-400">Logout</a>
        </div>
    </nav>

    <script>
        function toggleMenu() {
            const menu = document.getElementById('menu');
            menu.classList.toggle('hidden');
        }
    </script>

    <!-- Title -->
    <h2 class="text-2xl md:text-4xl font-bold text-white mt-16 animate-fadeInUp">Your Bookings</h2>

    <!-- Bookings Table (Desktop) -->
    <div class="w-full max-w-5xl p-4 md:p-6 mt-5 hidden md:block animate-fadeInUp">
        <div th:if="${not #lists.isEmpty(bookings)}">
            <div class="overflow-x-auto">
                <table
                    class="w-full text-center border-collapse shadow-lg rounded-lg overflow-hidden bg-gray-800 text-sm md:text-base">
                    <thead class="bg-green-600 text-white">
                        <tr>
                            <th class="p-3">Requester</th>
                            <th class="p-3">Start Time</th>
                            <th class="p-3">End Time</th>
                            <th class="p-3">Status</th>
                            <th class="p-3">Inspection</th>
                            <th class="p-3">Action</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-300">
                        <tr th:each="booking : ${bookings}" class="hover:bg-gray-700 transition">
                            <td class="p-2 border-b"
                                th:text="${booking.requester != null ? booking.requester.name : 'N/A'}"></td>
                            <td class="p-2 border-b"
                                th:text="${booking.startTime != null ? #temporals.format(booking.startTime, 'yyyy-MM-dd HH:mm') : 'Not Started'}">
                            </td>
                            <td class="p-2 border-b"
                                th:text="${booking.endTime != null ? #temporals.format(booking.endTime, 'yyyy-MM-dd HH:mm') : 'Not Finished'}">
                            </td>
                            <td class="p-2 border-b text-green-400 font-semibold"
                                th:text="${booking.status != null ? booking.status : 'Unknown'}"></td>
                            <td class="p-2 border-b">
                                <a th:if="${booking.status != null and booking.inspectionReport != null and booking.status.name() != 'PENDING' and booking.status.name() != 'ACCEPTED'}"
                                    th:href="@{/inspection/view/{bookingId}(bookingId=${booking.id})}"
                                    class="text-green-400 hover:text-green-300 transition">View</a>
                                <span
                                    th:unless="${booking.status != null and booking.inspectionReport != null and booking.status.name() != 'PENDING' and booking.status.name() != 'ACCEPTED'}"
                                    class="text-gray-400 italic text-sm">Report Not Available</span>
                            </td>
                            <td class="p-2 border-b">
                                <div class="flex flex-col md:flex-row md:flex-wrap gap-2 justify-center items-center">
                                    <form th:if="${booking.status != null and booking.status.name() == 'PENDING'}"
                                        th:action="@{/bookings/update-status}" method="post">
                                        <input type="hidden" name="bookingId" th:value="${booking.id}" />
                                        <input type="hidden" name="status" value="ACCEPTED" />
                                        <button type="submit"
                                            class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition w-full md:w-auto text-sm font-medium">
                                            Accept
                                        </button>
                                    </form>
                                    <a th:if="${booking.status != null and booking.status.name() == 'ACCEPTED'}"
                                        th:href="@{/inspection/submit/{bookingId}(bookingId=${booking.id})}"
                                        class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition w-full md:w-auto text-sm font-medium text-center">
                                        Submit Inspection Report
                                    </a>
                                    <a th:if="${booking.status != null and booking.status.name() == 'INSPECTION_DONE' and booking.inspectionReport != null}"
                                        th:href="@{/work/start/{id}(id=${booking.id})}"
                                        class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition w-full md:w-auto text-sm font-medium text-center">
                                        Start Work
                                    </a>
                                    <a th:if="${booking.status != null and booking.status.name() == 'IN_PROGRESS'}"
                                        th:href="@{/work/finish/{bookingId}(bookingId=${booking.id})}"
                                        class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition w-full md:w-auto text-sm font-medium text-center">
                                        Finish Work
                                    </a>
                                    <span
                                        th:if="${booking.status == null or (booking.status.name() != 'PENDING' and booking.status.name() != 'ACCEPTED' and booking.status.name() != 'INSPECTION_DONE' and booking.status.name() != 'IN_PROGRESS')}"
                                        class="text-gray-400 italic text-sm text-center w-full md:w-auto">
                                        No Action Needed
                                    </span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <p th:if="${#lists.isEmpty(bookings)}" class="text-red-500 text-lg mt-5">No bookings available.</p>
    </div>

    <!-- Mobile View (Cards) -->
    <div class="block md:hidden w-full px-4 mt-5 animate-fadeInUp" th:if="${not #lists.isEmpty(bookings)}">
        <div th:each="booking : ${bookings}" class="bg-gray-800 rounded-lg shadow-md p-4 mb-4 space-y-2">
            <p><span class="font-semibold text-green-400">Requester:</span> <span
                    th:text="${booking.requester != null ? booking.requester.name : 'N/A'}"></span></p>
            <p><span class="font-semibold">Start:</span> <span
                    th:text="${booking.startTime != null ? #temporals.format(booking.startTime, 'yyyy-MM-dd HH:mm') : 'Not Started'}"></span>
            </p>
            <p><span class="font-semibold">End:</span> <span
                    th:text="${booking.endTime != null ? #temporals.format(booking.endTime, 'yyyy-MM-dd HH:mm') : 'Not Finished'}"></span>
            </p>
            <p><span class="font-semibold text-green-400">Status:</span> <span
                    th:text="${booking.status != null ? booking.status : 'Unknown'}"></span></p>
            <p>
                <span class="font-semibold">Inspection:</span>
                <a th:if="${booking.status != null and booking.inspectionReport != null and booking.status.name() != 'PENDING' and booking.status.name() != 'ACCEPTED'}"
                    th:href="@{/inspection/view/{bookingId}(bookingId=${booking.id})}"
                    class="text-green-400 hover:text-green-300">View</a>
                <span
                    th:unless="${booking.status != null and booking.inspectionReport != null and booking.status.name() != 'PENDING' and booking.status.name() != 'ACCEPTED'}"
                    class="text-gray-400 italic text-sm">Report Not Available</span>
            </p>
            <div class="flex flex-col gap-2">
                <form th:if="${booking.status != null and booking.status.name() == 'PENDING'}"
                    th:action="@{/bookings/update-status}" method="post">
                    <input type="hidden" name="bookingId" th:value="${booking.id}" />
                    <input type="hidden" name="status" value="ACCEPTED" />
                    <button type="submit"
                        class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition text-sm font-medium">
                        Accept
                    </button>
                </form>
                <a th:if="${booking.status != null and booking.status.name() == 'ACCEPTED'}"
                    th:href="@{/inspection/submit/{bookingId}(bookingId=${booking.id})}"
                    class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition text-sm font-medium text-center">
                    Submit Inspection
                </a>
                <a th:if="${booking.status != null and booking.status.name() == 'INSPECTION_DONE' and booking.inspectionReport != null}"
                    th:href="@{/work/start/{id}(id=${booking.id})}"
                    class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition text-sm font-medium text-center">
                    Start Work
                </a>
                <a th:if="${booking.status != null and booking.status.name() == 'IN_PROGRESS'}"
                    th:href="@{/work/finish/{bookingId}(bookingId=${booking.id})}"
                    class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition text-sm font-medium text-center">
                    Finish Work
                </a>

            </div>
        </div>
    </div>

    <!-- Menu Toggle Script -->
    <script>
        const menuBtn = document.getElementById('menu-btn');
        const menu = document.getElementById('menu');

        menuBtn.addEventListener('click', () => {
            if (menu.classList.contains('max-h-0')) {
                menu.classList.remove('max-h-0', 'overflow-hidden');
                menu.classList.add('max-h-screen');
            } else {
                menu.classList.remove('max-h-screen');
                menu.classList.add('max-h-0', 'overflow-hidden');
            }
        });
    </script>

    <script th:src="@{/cursorParticles.js}"></script>
</body>

</html>